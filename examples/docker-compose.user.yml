# Docker Compose example for ServeM
# 
# Usage:
#   docker-compose -f docker-compose.user.yml up

version: '3.8'

services:
  # Option 1: Use base image with volume mount (for development)
  docs-dev:
    image: docker.io/jberends/servemd:latest
    container_name: servemd-dev
    ports:
      - "8080:8080"
    volumes:
      # Mount your local docs directory
      - ./docs:/app/__docs__:ro
      # Optional: Persistent cache
      - docs-cache:/app/__cache__
    environment:
      - DEBUG=true
      - BASE_URL=http://localhost:8080
      - MCP_ENABLED=true
    restart: unless-stopped
    profiles:
      - dev

  # Option 2: Use custom image (for production)
  docs-prod:
    build:
      context: .
      dockerfile: Dockerfile
    image: my-company/docs:latest
    container_name: servemd-prod
    ports:
      - "80:8080"
    environment:
      - DEBUG=false
      - BASE_URL=https://docs.mycompany.com
      - MCP_ENABLED=true
      - MCP_RATE_LIMIT_REQUESTS=120
      - MCP_RATE_LIMIT_WINDOW=60
    restart: always
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    profiles:
      - prod

volumes:
  docs-cache:

# Usage examples:
# 
# Development mode (with volume mount):
#   docker-compose --profile dev up
# 
# Production mode (with built image):
#   docker-compose --profile prod up -d
# 
# Build and run production:
#   docker-compose --profile prod up -d --build
# 
# View logs:
#   docker-compose logs -f docs-prod
# 
# Stop:
#   docker-compose down
